(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4530:()=>{},8108:()=>{},11345:(e,t,r)=>{Promise.resolve().then(r.bind(r,35484))},18590:()=>{},35484:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>m});var a=r(95155),l=r(35695),s=r(12115);let n=()=>{let e=(0,s.useRef)(null),t=(0,s.useRef)(null),[r,a]=(0,s.useState)(!1),[l,n]=(0,s.useState)(null),[c,i]=(0,s.useState)(null),[o,u]=(0,s.useState)(0);(0,s.useEffect)(()=>{let t=e.current;return(async()=>{try{let e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});t&&(t.srcObject=e,a(!0))}catch(e){n("无法访问摄像头，请检查权限或设备"),console.error("Camera error:",e)}})(),()=>{(null==t?void 0:t.srcObject)&&t.srcObject.getTracks().forEach(e=>e.stop())}},[]);let d=()=>{if(!e.current||!t.current)return;let r=t.current;r.width=e.current.videoWidth,r.height=e.current.videoHeight;let a=r.getContext("2d");null==a||a.drawImage(e.current,0,0),i(r.toDataURL("image/jpeg"))};return{videoRef:e,canvasRef:t,isCameraActive:r,error:l,capturedImage:c,countdown:o,startCountdown:()=>{if(!r||o>0)return;u(3);let e=setInterval(()=>{u(t=>1===t?(clearInterval(e),d(),0):t-1)},1e3)},resetCamera:()=>{i(null),n(null)}}};var c=r(73260),i=r(62995);r(68484);let o=async e=>{try{await c.jh6("webgl"),await c.Gc4();let t=await i.load(),r=new Image;r.src=e,await new Promise(e=>r.onload=e);let a=await t.detect(r);return{hasPerson:a.some(e=>"person"===e.class),predictions:a}}catch(e){throw console.error("Image analysis error:",e),Error("图像分析失败，请重试")}};var u=r(73084),d=r(61952);function m(){let{videoRef:e,canvasRef:t,isCameraActive:r,error:c,capturedImage:i,countdown:m,startCountdown:h,resetCamera:g}=n(),f=(0,l.useRouter)(),[b,v]=(0,s.useState)(!1),[x,j]=(0,s.useState)(null),{setImageDataUrl:w}=(0,d.g)(),p=async()=>{if(i)try{v(!0);let{hasPerson:e}=await o(i);console.log("pathname 类型:","string"),console.log("capturedImage 类型:",typeof i),e?(w(i),f.push("/result")):j("未检测到人物，请确保您的面部清晰可见")}catch(e){e instanceof Error?j(e.message):j("分析图像时出错")}finally{v(!1)}};return(0,s.useEffect)(()=>{i&&p()},[i]),(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen p-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"自拍检测"}),c&&(0,a.jsx)("p",{className:"text-red-500 mb-4",children:c}),x&&(0,a.jsx)("p",{className:"text-red-500 mb-4",children:x}),(0,a.jsxs)("div",{className:"camera-container",children:[(0,a.jsx)("video",{ref:e,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover"}),(0,a.jsx)("canvas",{ref:t,className:"hidden"}),m>0&&(0,a.jsx)("div",{className:"countdown-overlay",children:m})]}),(0,a.jsx)("button",{onClick:h,className:"mt-8 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all",disabled:!r||m>0||b,children:r?"开始自拍":"加载摄像头..."}),i&&(0,a.jsx)("button",{onClick:g,className:"mt-4 px-6 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-all",children:"重拍"}),b&&(0,a.jsx)(u.A,{})]})}},41234:()=>{},61952:(e,t,r)=>{"use strict";r.d(t,{ImageProvider:()=>n,g:()=>c});var a=r(95155),l=r(12115);let s=(0,l.createContext)({imageDataUrl:null,setImageDataUrl:()=>{}}),n=e=>{let{children:t}=e,[r,n]=(0,l.useState)(null);return(0,a.jsx)(s.Provider,{value:{imageDataUrl:r,setImageDataUrl:n},children:t})},c=()=>(0,l.useContext)(s)},73084:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var a=r(95155);r(12115);let l=()=>(0,a.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-t-4 border-blue-500 border-b-4 border-transparent"})})},80551:()=>{},85817:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[690,272,660,56,87,251,674,595,441,684,358],()=>t(11345)),_N_E=e.O()}]);