(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[834],{53738:(e,t,r)=>{Promise.resolve().then(r.bind(r,68666))},61952:(e,t,r)=>{"use strict";r.d(t,{ImageProvider:()=>n,g:()=>o});var a=r(95155),l=r(12115);let s=(0,l.createContext)({imageDataUrl:null,setImageDataUrl:()=>{}}),n=e=>{let{children:t}=e,[r,n]=(0,l.useState)(null);return(0,a.jsx)(s.Provider,{value:{imageDataUrl:r,setImageDataUrl:n},children:t})},o=()=>(0,l.useContext)(s)},68666:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var a=r(95155),l=r(12115);let s=async(e,t)=>{try{let r=e.replace(/^data:image\/jpeg;base64,/,""),a=atob(r),l=Array(a.length);for(let e=0;e<a.length;e++)l[e]=a.charCodeAt(e);let s=new Uint8Array(l),n=new Blob([s],{type:"image/jpeg"}),o=new FormData;o.append("image",n,"selfie.jpg");let c=await fetch("http://localhost:3001/images",{method:"POST",headers:{Authorization:"Bearer ".concat(t)},body:o});if(!c.ok)throw Error("上传失败");return await c.json()}catch(e){throw console.error("Upload error:",e),Error("上传到服务器失败")}};var n=r(73084),o=r(61952),c=r(66766);function i(){let{imageDataUrl:e}=(0,o.g)(),[t,r]=(0,l.useState)("等待上传..."),[i,d]=(0,l.useState)(!0),[u,h]=(0,l.useState)(null),[m,g]=(0,l.useState)("");return(0,l.useEffect)(()=>{let e=localStorage.getItem("jwt_token");console.log("Retrieved JWT Token:",e),e&&g(e)},[]),(0,l.useEffect)(()=>{e&&(async()=>{try{r("正在上传...");let t=await s(e,m);r("上传成功！"),console.log("Upload result:",t)}catch(e){e instanceof Error?h(e.message):h("上传失败")}finally{d(!1)}})()},[e,m]),(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center min-h-screen p-8",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"自拍结果"}),i&&(0,a.jsx)(n.A,{}),(0,a.jsx)("div",{className:"camera-container mb-8",children:e&&(0,a.jsx)(c.default,{src:e,alt:"自拍照片",width:400,height:400,className:"w-full h-full object-cover"})}),t&&(0,a.jsx)("p",{className:"text-lg ".concat("上传成功！"===t?"text-green-600":"text-gray-600"),children:t}),u&&(0,a.jsx)("p",{className:"text-red-500 mt-2",children:u}),(0,a.jsx)("button",{onClick:()=>window.location.href="/",className:"mt-8 px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-all",children:"再拍一张"})]})}},73084:(e,t,r)=>{"use strict";r.d(t,{A:()=>l});var a=r(95155);r(12115);let l=()=>(0,a.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-t-4 border-blue-500 border-b-4 border-transparent"})})}},e=>{var t=t=>e(e.s=t);e.O(0,[766,441,684,358],()=>t(53738)),_N_E=e.O()}]);